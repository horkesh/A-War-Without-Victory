{
  "permissions": {
    "allow": [
      "Bash(grep:*)",
      "Bash(npx tsc:*)",
      "Bash(npx vitest:*)",
      "Bash(node:*)",
      "Bash(git stash:*)",
      "WebFetch(domain:pbs.twimg.com)",
      "WebFetch(domain:github.com)",
      "Bash(claude /plugin marketplace add obra/superpowers-marketplace)",
      "Bash(npx tsx:*)",
      "Bash(npm test)",
      "Bash(npm run desktop:map:build:*)",
      "Bash(npm run desktop:sim:build:*)",
      "Bash(npx vite:*)",
      "Bash(timeout:*)",
      "Bash(npm run typecheck:*)",
      "Bash(npm run test:vitest:*)",
      "Bash(tasklist:*)",
      "Bash(findstr:*)",
      "Bash(powershell:*)",
      "Bash(npm run dev:map:*)",
      "Bash(dir:*)",
      "Bash(find:*)",
      "Bash(python3:*)",
      "Bash(python:*)",
      "Bash(F:/A-War-Without-Victory/tools/_fix_enclave.py << 'PYEOF'\nimport json\n\nFILE = \"F:/A-War-Without-Victory/data/source/oob_brigades.json\"\n\nwith open\\(FILE, \"r\", encoding=\"utf-8\"\\) as f:\n    data = json.load\\(f\\)\n\nfixed = 0\nfor b in data[\"brigades\"]:\n    sub = b.get\\(\"subordinate_to\", \"\"\\)\n    if b[\"faction\"] == \"RBiH\" and \\(\"28th_independent\" in sub or \"81st_independent\" in sub\\):\n        if b.get\\(\"available_from\"\\) != 12:\n            print\\(f\"  Fixing {b['id']}: available_from {b.get\\('available_from'\\)} -> 12\"\\)\n            b[\"available_from\"] = 12\n            # These should NOT be mandatory \\(not turn 0\\)\n            if \"mandatory\" in b:\n                del b[\"mandatory\"]\n            fixed += 1\n\nprint\\(f\"\\\\nFixed {fixed} enclave brigades\"\\)\n\nwith open\\(FILE, \"w\", encoding=\"utf-8\"\\) as f:\n    json.dump\\(data, f, indent=2, ensure_ascii=False\\)\n    f.write\\(\"\\\\n\"\\)\n\nprint\\(\"Done\"\\)\nPYEOF)",
      "Bash(\"F:\\\\A-War-Without-Victory\\\\docs\\\\40_reports\\\\implemented\\\\DEFINITIVE_APR1992_SCENARIO_2026_02_14.md\" << 'ENDOFFILE'\n# Definitive April 1992 Scenario — Implementation Report\n\n**Date:** 2026-02-14\n**Type:** Scenario authoring + OOB data cleanup + mechanic implementation\n**Scope:** April 1992 \"Independence\" — the first fully calibrated scenario\n\n---\n\n## 1. Objective\n\nCreate one working, historically calibrated scenario for April 1992 \\(start of the Bosnian War\\). The scenario needed correct starting parameters, cleaned-up OOB data, JNA transition mechanics, and an enhanced side-picker UI.\n\n---\n\n## 2. OOB Data Cleanup \\(Phase 1\\)\n\n### 2.1 HRHB Subordination Bug Fix\n- **15 HRHB brigades** incorrectly assigned `subordinate_to: \"vrs_herzegovina\"` \\(Serb corps\\)\n- Remapped to correct HVO operational zones based on home municipality\n\n### 2.2 Corps Field Mapping Fix\n- **Bug:** `oob_loader.ts` line 105 read `r.corps` but data uses `subordinate_to`\n- **Fix:** Fall back to `subordinate_to` when `corps` is absent\n- **Result:** All 261 brigades now have corps assignments \\(was 0 before\\)\n\n### 2.3 7th Corps Removal\n- Removed `arbih_7th_corps` from `oob_corps.json` \\(formed November 1993, not April 1992\\)\n- Remapped 12 subordinate brigades to `arbih_3rd_corps`\n\n### 2.4 Equipment Classes\n- Added `default_equipment_class` to all 261 brigades\n- Distribution: mountain \\(122\\), light_infantry \\(114\\), motorized \\(19\\), mechanized \\(5\\), special \\(1\\)\n\n### 2.5 Available From / Mandatory\n- Added `available_from` turn gates: turn 0 \\(211\\), turn 8 \\(21\\), turn 12 \\(7\\), turn 16 \\(2\\), turn 26 \\(20\\)\n- Added `mandatory: true` to 211 core brigades \\(all available_from: 0\\)\n\n---\n\n## 3. Initial Formations \\(Phase 2\\)\n\nRebuilt `initial_formations_apr1992.json` from 3-entry stub to 25 entries:\n- **9 RBiH corps:** General Staff + 1st–6th Corps + 28th Independent + 81st Independent\n- **7 RS corps:** Main Staff + 6 corps\n- **4 HRHB OZs:** SE Herzegovina, Central Bosnia, NW Bosnia, Tomislavgrad\n- **5 JNA ghost brigades** \\(RS faction, see Phase 3\\)\n\nAll corps entries use `kind: \"corps_asset\"` with correct `hq_sid` from municipality HQ settlement mapping.\n\n---\n\n## 4. JNA Ghost Brigade Mechanic \\(Phase 3\\)\n\n### Design\nFive RS mechanized/motorized brigades representing residual JNA forces:\n- Banja Luka \\(2500 personnel, dissolve week 16\\)\n- Bijeljina \\(2000, dissolve week 12\\)\n- Pale \\(2000, dissolve week 14\\)\n- Doboj \\(1800, dissolve week 10\\)\n- Brčko \\(1500, dissolve week 8\\)\n\n### Implementation\n- **Tag-based:** `jna_legacy`, `auto_degrade`, `dissolve:N` — zero schema changes\n- **New file:** `src/sim/jna_ghost_degradation.ts` — `runJNAGhostDegradation\\(\\)`\n- **Behavior:** Starting 4 turns before dissolution, reduce personnel by 25%/turn. At dissolve turn, set status=inactive\n- **Wired into:** Both Phase I and Phase II turn pipeline \\(early, before combat\\)\n\n### Extended initial_formations_loader.ts\n- Added `posture` and `corps_id` field support so ghost brigades start in `attack` posture\n\n---\n\n## 5. Scenario Parameters \\(Phase 4\\)\n\n### New file: `data/scenarios/apr1992_definitive_52w.json`\n\n| Parameter | RS | RBiH | HRHB | Rationale |\n|---|---|---|---|---|\n| Recruitment capital | 350 | 200 | 120 | JNA org continuity vs desperate TO mobilization |\n| Equipment points | 500 | 40 | 150 | JNA arsenal vs arms embargo vs Croatian pipeline |\n| Capital trickle | 4 | 2 | 3 | Organizational capacity per turn |\n| Equipment trickle | 3 | 0 | 2 | Embargo = zero heavy inflow for RBiH |\n| Max recruits/turn | 2 | 2 | 2 | Global cap |\n\n### Coercion Municipalities \\(17\\)\nPrijedor \\(0.90\\), Zvornik \\(0.85\\), Foča \\(0.85\\), Bratunac \\(0.80\\), Višegrad \\(0.80\\), Vlasenica \\(0.75\\), Bijeljina \\(0.75\\), Bosanski Šamac \\(0.70\\), Sanski Most \\(0.70\\), Ključ \\(0.65\\), Bosanski Novi \\(0.65\\), Rogatica \\(0.60\\), Brčko \\(0.60\\), Doboj \\(0.55\\), Kotor Varoš \\(0.65\\), Teslić \\(0.55\\), Srebrenica \\(0.55\\)\n\n### Desktop Updated\n- `desktop_sim.ts`: `NEW_GAME_SCENARIO_RELATIVE` → `apr1992_definitive_52w.json`\n- Recruitment capital and equipment constants updated to match\n\n---\n\n## 6. Side-Picker UI Enhancement \\(Phase 5\\)\n\n### Scenario Briefing Header\n- Image + title \\(\"April 1992 — Independence\"\\) + italic subtitle\n- External image at `assets/sources/scenarios/apr1992_briefing.png` \\(user-sourced\\)\n\n### Per-Faction Descriptions with Difficulty Badges\n- **RBiH — HARD** \\(red\\): \"Surrounded and outgunned...\"\n- **RS — STANDARD** \\(green\\): \"Inherit the JNA arsenal...\"\n- **HRHB — MODERATE** \\(amber\\): \"Backed by Zagreb but squeezed...\"\n\n### CSS\n- Card widened to 640px for descriptions\n- Difficulty badges: colored pills with Material Design palette\n- Description text: small, italic, centered\n\n### Vite Build\n- Extended `copyCrestsIntoBuild` plugin to also copy `assets/sources/scenarios/`\n\n---\n\n## 7. Files Modified\n\n| File | Changes |\n|---|---|\n| `data/source/oob_brigades.json` | Fix 15 HRHB subordination, remap 12×7th Corps→3rd, add equipment_class/available_from/mandatory to all 261 |\n| `data/source/oob_corps.json` | Remove `arbih_7th_corps` |\n| `src/scenario/oob_loader.ts` | Fix corps field: read `subordinate_to` as fallback |\n| `src/scenario/initial_formations_loader.ts` | Add `posture` and `corps_id` field support |\n| `data/scenarios/initial_formations/initial_formations_apr1992.json` | Full rebuild: 20 corps + 5 JNA ghost brigades |\n| `data/scenarios/apr1992_definitive_52w.json` | New canonical scenario |\n| `src/sim/jna_ghost_degradation.ts` | New: JNA ghost brigade auto-degrade step |\n| `src/sim/turn_pipeline.ts` | Wire JNA degradation into Phase I and Phase II pipelines |\n| `src/desktop/desktop_sim.ts` | Update scenario path + resource constants |\n| `src/ui/map/tactical_map.html` | Enhanced side-picker: descriptions, difficulty, scenario header |\n| `src/ui/map/styles/tactical-map.css` | Side-picker styling: scenario briefing, badges, descriptions |\n| `src/ui/map/MapApp.ts` | Scenario image loading in side-picker handler |\n| `src/ui/map/vite.config.ts` | Extended build plugin to copy scenario assets |\n\n---\n\n## 8. Verification\n\n- `npm run typecheck` — clean\n- `npm run test:vitest` — 8 suites, 119 tests, all pass\n- OOB loader tests — 3/3 pass\n- Initial formations loader — 25 formations loaded correctly\n- JNA ghost degradation — verified degradation/dissolution at correct turns\n- All 261 brigades have corps assignments \\(verified\\)\n- No 7th Corps references \\(verified\\)\n- No HRHB subordination bugs \\(verified\\)\n\n---\n\n## 9. Determinism\n\nAll changes are deterministic:\n- Formation iteration uses sorted keys via `strictCompare`\n- JNA ghost degradation iterates in sorted order, no randomness\n- Tag parsing is string-based, deterministic\n- OOB loader sort unchanged \\(faction then name\\)\n- No timestamps or Math.random\\(\\) introduced\n\n---\n\n## 10. User Action Required\n\n- **Scenario image:** Place a PNG at `assets/sources/scenarios/apr1992_briefing.png` \\(the UI gracefully hides if missing\\)\n- **Calibration run:** Execute `npm run sim:scenario:run -- --scenario data/scenarios/apr1992_definitive_52w.json` to verify RS reaches 60-70% territory by week 26\nENDOFFILE)",
      "Bash(npx vitest run)",
      "Bash(npm run canon:check:*)",
      "Bash(SET UPDATE_BASELINES=1)",
      "Bash($env:UPDATE_BASELINES=\"1\")",
      "Bash(UPDATE_BASELINES=1 npx tsx:*)",
      "Bash(ls -la \"F:\\\\A-War-Without-Victory\\\\docs\\\\40_reports\\\\implemented\"\" 2>&1 || ls -la \"F:/A-War-Without-Victory/docs/40_reports/implemented/ \")",
      "Bash(npx tsc --noEmit)",
      "Bash(npm run desktop:*)",
      "Bash(npm run sim:scenario:run:default:*)",
      "Bash(\"F:\\\\A-War-Without-Victory\\\\_tmp_analyze.ts\" << 'SCRIPT'\nconst fs = require\\('fs'\\);\nconst data = JSON.parse\\(fs.readFileSync\\('data/source/oob_brigades.json','utf8'\\)\\);\nconst brigades = data.brigades;\n\nconst stats: any = {};\nfor \\(const b of brigades\\) {\n  const key = b.faction;\n  if \\(!stats[key]\\) stats[key] = { total: 0, t0: 0, mandatory: 0, byCorps: {}, earlyBrigades: [] };\n  stats[key].total++;\n  if \\(b.available_from === 0\\) stats[key].t0++;\n  if \\(b.mandatory\\) stats[key].mandatory++;\n\n  const corps = b.subordinate_to || 'none';\n  if \\(!stats[key].byCorps[corps]\\) stats[key].byCorps[corps] = { total: 0, t0: 0 };\n  stats[key].byCorps[corps].total++;\n  if \\(b.available_from === 0\\) stats[key].byCorps[corps].t0++;\n\n  if \\(b.available_from <= 4 && b.mandatory\\) {\n    stats[key].earlyBrigades.push\\({ id: b.id, name: b.name, home: b.home_mun, corps: b.subordinate_to, avail: b.available_from, equip: b.default_equipment_class }\\);\n  }\n}\n\nfor \\(const [faction, s] of Object.entries\\(stats\\) as any\\) {\n  console.log\\('=== ' + faction + ' ==='\\);\n  console.log\\('Total:', s.total, '| Turn-0:', s.t0, '| Mandatory:', s.mandatory\\);\n  console.log\\('By corps \\(total / turn-0\\):'\\);\n  for \\(const [corps, c] of Object.entries\\(s.byCorps\\).sort\\(\\) as any\\) {\n    console.log\\('  ' + corps + ':', c.total + ' / ' + c.t0\\);\n  }\n  console.log\\('Early mandatory brigades \\(avail<=4\\):'\\);\n  for \\(const b of s.earlyBrigades\\) {\n    console.log\\('  ' + b.id + ' | ' + b.name + ' | ' + b.home + ' | ' + b.corps + ' | T' + b.avail + ' | ' + b.equip\\);\n  }\n  console.log\\(\\);\n}\nSCRIPT)",
      "Bash(\"F:\\\\A-War-Without-Victory\\\\_tmp_analyze.ts\" << 'SCRIPT'\nimport fs from 'fs';\nconst data = JSON.parse\\(fs.readFileSync\\('data/source/oob_brigades.json','utf8'\\)\\);\nconst brigades = data.brigades;\n\nconst stats: any = {};\nfor \\(const b of brigades\\) {\n  const key = b.faction;\n  if \\(!stats[key]\\) stats[key] = { total: 0, t0: 0, mandatory: 0, byCorps: {}, earlyBrigades: [] };\n  stats[key].total++;\n  if \\(b.available_from === 0\\) stats[key].t0++;\n  if \\(b.mandatory\\) stats[key].mandatory++;\n\n  const corps = b.subordinate_to || 'none';\n  if \\(!stats[key].byCorps[corps]\\) stats[key].byCorps[corps] = { total: 0, t0: 0 };\n  stats[key].byCorps[corps].total++;\n  if \\(b.available_from === 0\\) stats[key].byCorps[corps].t0++;\n\n  if \\(b.available_from <= 4 && b.mandatory\\) {\n    stats[key].earlyBrigades.push\\({ id: b.id, name: b.name, home: b.home_mun, corps: b.subordinate_to, avail: b.available_from, equip: b.default_equipment_class }\\);\n  }\n}\n\nfor \\(const [faction, s] of Object.entries\\(stats\\) as any\\) {\n  console.log\\('=== ' + faction + ' ==='\\);\n  console.log\\('Total:', s.total, '| Turn-0:', s.t0, '| Mandatory:', s.mandatory\\);\n  console.log\\('By corps \\(total / turn-0\\):'\\);\n  for \\(const [corps, c] of Object.entries\\(s.byCorps\\).sort\\(\\) as any\\) {\n    console.log\\('  ' + corps + ':', c.total + ' / ' + c.t0\\);\n  }\n  console.log\\('Early mandatory brigades \\(avail<=4\\):'\\);\n  for \\(const b of s.earlyBrigades\\) {\n    console.log\\('  ' + b.id + ' | ' + b.name + ' | ' + b.home + ' | ' + b.corps + ' | T' + b.avail + ' | ' + b.equip\\);\n  }\n  console.log\\(\\);\n}\nSCRIPT)",
      "Bash(powershell -Command:*)",
      "Bash(node -e:*)",
      "Bash(dir /s \"F:\\\\A-War-Without-Victory\\\\.agent\" \"F:\\\\A-War-Without-Victory\\\\.cursor\\\\rules\")",
      "Bash(tee:*)",
      "Bash(npm run sim:scenario:run:*)",
      "Bash(ls:*)",
      "Bash(powershell -Command \"$word = New-Object -ComObject Word.Application; $word.Visible = $false; $doc = $word.Documents.Open\\(''C:\\\\Users\\\\User\\\\Downloads\\\\WARROOM_SETUP_AND_PHASE0_EXECUTION_PROPOSAL.docx''\\); $doc.Content.Text; $doc.Close\\(\\); $word.Quit\\(\\)\")",
      "Bash(npm test:*)",
      "Bash(npm run warroom:build:*)",
      "Bash(ls \"F:\\\\A-War-Without-Victory\\\\docs\\\\40_reports\\\\implemented\"\" 2>&1 || echo \"Directory does not exist \")",
      "Bash(done)",
      "Bash(npx vite build:*)",
      "Bash(powershell -c \"Get-Content ''C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\claude\\\\F--A-War-Without-Victory\\\\tasks\\\\bed585c.output'' | Select-Object -Last 20\")",
      "Bash(powershell -c \"Select-String -Path ''C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\claude\\\\F--A-War-Without-Victory\\\\tasks\\\\bed585c.output'' -Pattern ''fail|FAIL|not ok'' | Select-Object -Last 20\")",
      "Bash(powershell -c:*)",
      "Bash(cmd /c type \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\claude\\\\F--A-War-Without-Victory\\\\tasks\\\\b73f2e8.output\")",
      "Bash(del \"F:\\\\A-War-Without-Victory\\\\tests\\\\_debug_supply.ts\")",
      "Bash(copy \"F:\\\\A-War-Without-Victory\\\\data\\\\ui\\\\hq_clickable_regions.json\" \"F:\\\\A-War-Without-Victory\\\\src\\\\ui\\\\warroom\\\\public\\\\data\\\\ui\\\\hq_clickable_regions.json\" /Y)",
      "Bash(node --import tsx src/scenario/scenario_runner.ts:*)",
      "Bash(taskkill:*)",
      "Bash(TASKKILL /F /IM electron.exe)",
      "Bash(cmd /c \"TASKKILL /F /IM electron.exe\")",
      "Bash(npx electron .)",
      "WebFetch(domain:localhost)",
      "Bash(curl:*)",
      "Bash(cmd /c \"netstat -ano | findstr :3001\")",
      "Bash(cmd /c \"netstat -ano | findstr LISTENING | findstr 3001\")",
      "Bash(cmd /c:*)",
      "Bash(ls \"F:\\\\A-War-Without-Victory\\\\data\\\\derived\\\\terrain\"\" 2>NUL || echo \"Directory not found \")",
      "Bash(dir /b \"F:\\\\A-War-Without-Victory\\\\docs\")",
      "Bash(powershell -Command \"Get-ChildItem -Path src -Recurse -File | Select-String ''SETTLEMENT_BORDER'' | Select-Object Path, LineNumber, Line\")",
      "Bash(powershell -Command \"Get-ChildItem -Path src -Recurse -File -Include ''*.ts'' | Select-String ''SETTLEMENT_BORDER'' | Select-Object Path, LineNumber, Line\")",
      "Bash(npx tsx --test:*)"
    ]
  }
}
